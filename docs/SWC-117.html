<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>SWC-117 · Overview</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Title"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="SWC-117 · Overview"/><meta property="og:type" content="website"/><meta property="og:url" content="https://SmartContractSecurity.github.io/SWC-registry/index.html"/><meta property="og:description" content="# Title"/><meta property="og:image" content="https://SmartContractSecurity.github.io/SWC-registry/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://SmartContractSecurity.github.io/SWC-registry/img/docusaurus.png"/><link rel="shortcut icon" href="/SWC-registry/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.1.0/tablesort.min.js"></script><link rel="stylesheet" href="/SWC-registry/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/SWC-registry/"><h2 class="headerTitle">Overview</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/SWC-registry/docs/SWC-100" target="_self">Registry</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>SWC ID</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">SWC ID</h3><ul><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-100">SWC-100</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-101">SWC-101</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-102">SWC-102</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-103">SWC-103</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-104">SWC-104</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-105">SWC-105</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-106">SWC-106</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-107">SWC-107</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-108">SWC-108</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-109">SWC-109</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-110">SWC-110</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-111">SWC-111</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-112">SWC-112</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-113">SWC-113</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-114">SWC-114</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-115">SWC-115</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-116">SWC-116</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/SWC-registry/docs/SWC-117">SWC-117</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-118">SWC-118</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-119">SWC-119</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-120">SWC-120</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-121">SWC-121</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-122">SWC-122</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docMainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">SWC-117</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="title"></a><a href="#title" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Title</h1>
<p>Signature Malleability</p>
<h2><a class="anchor" aria-hidden="true" id="relationships"></a><a href="#relationships" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Relationships</h2>
<p><a href="https://cwe.mitre.org/data/definitions/347.html">Improper Verification of Cryptographic Signature</a></p>
<h2><a class="anchor" aria-hidden="true" id="description"></a><a href="#description" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Description</h2>
<p>The implementation of a cryptographic signature system in Ethereum contracts often assumes that the signature is unique, but signatures can be altered without the possesion of the private key and still be valid. The EVM specification defines several so-called ‘precompiled’ contracts one of them being <code>ecrecover</code> which executes the elliptic curve public key recovery. A malicious user can slightly modify the three values <em>v</em>, <em>r</em> and <em>s</em> to create other valid signatures. A system that performs signature verification on contract level might be susceptible to attacks if the signature is part of the signed message hash. Valid signatures could be created by a malicious user to replay previously signed messages.</p>
<h2><a class="anchor" aria-hidden="true" id="remediation"></a><a href="#remediation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remediation</h2>
<p>A signature should never be included into a signed message hash to check if previously messages have been processed by the contract.</p>
<h2><a class="anchor" aria-hidden="true" id="references"></a><a href="#references" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h2>
<p><a href="https://eklitzke.org/bitcoin-transaction-malleability">Bitcoin Transaction Malleability</a>
<a href="https://ropsten.etherscan.io/address/0x0daabce0a1261b582e0d949ebca9dff4c22c88ef#code">CTF - Challenge</a></p>
<h2><a class="anchor" aria-hidden="true" id="contract-samples"></a><a href="#contract-samples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contract Samples</h2>
<h3><a class="anchor" aria-hidden="true" id="transaction-malleablitysol"></a><a href="#transaction-malleablitysol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transaction_malleablity.sol</h3>
<pre><code class="hljs css language-Solity">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.24</span>;

<span class="hljs-class"><span class="hljs-keyword">contract</span> <span class="hljs-title">transaction_malleablity</span></span>{
  <span class="hljs-keyword">mapping</span>(<span class="hljs-keyword">address</span> =&gt; <span class="hljs-keyword">uint256</span>) balances;
  <span class="hljs-keyword">mapping</span>(<span class="hljs-keyword">bytes32</span> =&gt; <span class="hljs-keyword">bool</span>) signatureUsed;

  constructor(<span class="hljs-keyword">address</span>[] owners, <span class="hljs-keyword">uint</span>[] init){
    <span class="hljs-keyword">require</span>(owners.<span class="hljs-built_in">length</span> == init.<span class="hljs-built_in">length</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">uint</span> i=<span class="hljs-number">0</span>; i &lt; owners.<span class="hljs-built_in">length</span>; i ++){
      balances[owners[i]] = init[i];
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transfer</span>(<span class="hljs-params">
        <span class="hljs-keyword">bytes</span> _signature,
        <span class="hljs-keyword">address</span> _to,
        <span class="hljs-keyword">uint256</span> _value,
        <span class="hljs-keyword">uint256</span> _gasPrice,
        <span class="hljs-keyword">uint256</span> _nonce</span>)
      <span class="hljs-title">public</span>
    <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">bool</span></span>)
    </span>{
      <span class="hljs-keyword">bytes32</span> txid = keccak256(abi.encodePacked(getTransferHash(_to, _value, _gasPrice, _nonce), _signature));
      <span class="hljs-keyword">require</span>(!signatureUsed[txid]);

      <span class="hljs-keyword">address</span> from = recoverTransferPreSigned(_signature, _to, _value, _gasPrice, _nonce);

      <span class="hljs-keyword">require</span>(balances[from] &gt; _value);
      balances[from] -= _value;
      balances[_to] += _value;

      signatureUsed[txid] = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recoverTransferPreSigned</span>(<span class="hljs-params">
        <span class="hljs-keyword">bytes</span> _sig,
        <span class="hljs-keyword">address</span> _to,
        <span class="hljs-keyword">uint256</span> _value,
        <span class="hljs-keyword">uint256</span> _gasPrice,
        <span class="hljs-keyword">uint256</span> _nonce</span>)
      <span class="hljs-title">public</span>
      <span class="hljs-title">view</span>
    <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">address</span> recovered</span>)
    </span>{
        <span class="hljs-keyword">return</span> ecrecoverFromSig(getSignHash(getTransferHash(_to, _value, _gasPrice, _nonce)), _sig);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTransferHash</span>(<span class="hljs-params">
        <span class="hljs-keyword">address</span> _to,
        <span class="hljs-keyword">uint256</span> _value,
        <span class="hljs-keyword">uint256</span> _gasPrice,
        <span class="hljs-keyword">uint256</span> _nonce</span>)
      <span class="hljs-title">public</span>
      <span class="hljs-title">view</span>
    <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">bytes32</span> txHash</span>) </span>{
        <span class="hljs-keyword">return</span> keccak256(<span class="hljs-keyword">address</span>(<span class="hljs-built_in">this</span>), <span class="hljs-keyword">bytes4</span>(<span class="hljs-number">0x1296830d</span>), _to, _value, _gasPrice, _nonce);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSignHash</span>(<span class="hljs-params"><span class="hljs-keyword">bytes32</span> _hash</span>)
      <span class="hljs-title">public</span>
      <span class="hljs-title">pure</span>
    <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">bytes32</span> signHash</span>)
    </span>{
        <span class="hljs-keyword">return</span> keccak256(<span class="hljs-string">"\x19Ethereum Signed Message:\n32"</span>, _hash);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ecrecoverFromSig</span>(<span class="hljs-params"><span class="hljs-keyword">bytes32</span> hash, <span class="hljs-keyword">bytes</span> sig</span>)
      <span class="hljs-title">public</span>
      <span class="hljs-title">pure</span>
    <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">address</span> recoveredAddress</span>)
    </span>{
        <span class="hljs-keyword">bytes32</span> r;
        <span class="hljs-keyword">bytes32</span> s;
        <span class="hljs-keyword">uint8</span> v;
        <span class="hljs-keyword">if</span> (sig.<span class="hljs-built_in">length</span> != <span class="hljs-number">65</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">address</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">assembly</span> {
            r := mload(add(sig, <span class="hljs-number">32</span>))
            s := mload(add(sig, <span class="hljs-number">64</span>))
            v := <span class="hljs-keyword">byte</span>(<span class="hljs-number">0</span>, mload(add(sig, <span class="hljs-number">96</span>)))
        }
        <span class="hljs-keyword">if</span> (v &lt; <span class="hljs-number">27</span>) {
          v += <span class="hljs-number">27</span>;
        }
        <span class="hljs-keyword">if</span> (v != <span class="hljs-number">27</span> &amp;&amp; v != <span class="hljs-number">28</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">address</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> ecrecover(hash, v, r, s);
    }
}

</code></pre>
<h4><a class="anchor" aria-hidden="true" id="config"></a><a href="#config" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Config</h4>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">"Calculates transaction identifier with signature"</span>
<span class="hljs-attr">issues:</span>
<span class="hljs-attr">- id:</span> <span class="hljs-string">"SWC-117"</span>
<span class="hljs-attr">  count:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  locations:</span>
<span class="hljs-attr">  - bytecode_offsets:</span>
<span class="hljs-attr">    line_numbers:</span> <span class="hljs-string">[23]</span>

</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/SWC-registry/docs/SWC-116"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/SWC-registry/docs/SWC-118"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav docOnPageNav"><ul class="toc-headings"><li><a href="#relationships">Relationships</a></li><li><a href="#description">Description</a></li><li><a href="#remediation">Remediation</a></li><li><a href="#references">References</a></li><li><a href="#contract-samples">Contract Samples</a><ul class="toc-headings"><li><a href="#transaction-malleablitysol">transaction_malleablity.sol</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="https://smartcontractsecurity.github.io/SWC-registry/#create-a-new-swc-entry">How to add a SWC definition</a><a href="https://smartcontractsecurity.github.io/SWC-registry/#create-a-test-case">How to add a test case</a><a href="">EIP XXXX</a></div><div><h5>Community</h5><a href="https://discord.gg/qcNvR2r">Join the Discord channel #swc-registry</a><a href="">Discussion at the Ethereum Magicians</a></div><div><h5>More</h5><a href="https://github.com/SmartContractSecurity/SWC-registry/">Back to SWC-registry repo</a></div></section><section class="copyright">Copyright © 2018 SmartContractSecurity</section></footer></div></body></html>